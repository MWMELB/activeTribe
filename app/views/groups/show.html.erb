<div class="container mt-5 px-4">
  <div class="row">
    <div class="col">

      <div class="group-title">
        <div class="d-flex justify-content-between">
          <div class=""><%= link_to '<i class="icon fa-solid fa-angle-left"></i>'.html_safe, :back %></div>
          <h3><%= @group.name %></h3>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="my-3">
  <% if @group.photo.attached? %>
    <%= image_tag @group.photo, class: "group-banner-image" %>
  <% end %>
</div>

<div class="container px-4 pb-4 mb-5">
  <div class="row">
    <div class="col">
      <div class="group-btns d-flex justify-content-end">
        <% if policy(@group).owner? %>
          <div class="d-flex pt-2">
            <%= link_to '<i class="fa-solid fa-pen"></i>'.html_safe, edit_group_path(@group), class: "btn-icon me-3" %>
            <%= link_to '<i class="fa-regular fa-trash-can"></i>'.html_safe, @group, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this group?" }, class: "btn-icon" %>
          </div>
        <% elsif GroupUser.find_by(group: @group, user: current_user) %>
          <%= link_to '<i class="fa-solid fa-arrow-right-from-bracket"></i>'.html_safe, leave_group_path(@group), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to leave this group?" } %>
        <% end %>
      </div>

      <div class="group-description card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h5>About us</h5>
            <p style="color: grey"><%= format_member(@group.members.count)%></p>
          </div>
          <p><%= @group.description %></p>
        </div>
      </div>


    <% if !(policy(@group).owner? || GroupUser.find_by(group: @group, user: current_user)) %>
      <%= button_to "Join us", join_group_path(@group), method: :post, class: "btn btn-secondary" %>
    <% end %>

    <!-- post Form -->
    <% if policy(@group).post? %>
      <div class="mt-5">
        <h3>Connect:</h3>
        <%= form_with model: @post, url: group_group_posts_path(@group), method: :post, local: true do |form| %>
          <div class="form-group pb-2">
            <%= form.text_area :content, class: "form-control", rows: 3, placeholder: "Write something..." %>
          </div>
          <%= form.submit "Post", class: "btn btn-primary" %>
        <% end %>
      </div>
    <% end %>

      <!-- posts Section -->
    <div class="mt-5">
      <h2 class="mt-3">Recent Posts</h2>
      <% if @group_posts.any? %>
        <% @group_posts.each do |post| %>
          <%= link_to group_group_post_path(post.group, post), class: "card-link" do %>
            <div class="card mb-3">
              <div class="card-body">
                <p><strong><%= post.user.username %>:</strong> <%= post.content %></p>
                <div class="d-flex justify-content-between">
                  <p><small><%= time_ago_in_words(post.created_at) %> ago</small></p>
                  <%# <% if post.user == current_user %>
                    <%# <%= link_to '<i class="fa-regular fa-trash-can"></i>'.html_safe, group_group_post_path(@group, post), method: :delete, data: { turbo: false, turbo_confirm: "Are you sure you want to delete this comment?"} %>
                  <%# <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <p>No posts yet.</p>
      <% end %>
    </div>

    </div>
  </div>
</div>
