<div class="container mt-5 px-4">
  <div data-controller="toggle">
    <div class="d-flex justify-content-between">
      <div class=""><%= link_to '<i class="icon fa-solid fa-angle-left back-icon"></i>'.html_safe, :back %></div>
      <div class="d-flex">
        <h3 class="px-2"><%= @activity.title.capitalize %></h3>
        <% if policy(@activity).owner? %>
          <i data-action="click->toggle#fire" class="fa-solid fa-caret-down pt-1"></i>
        <% end %>
      </div>
    </div>

    <div class="activity-btns d-flex justify-content-end d-none" data-toggle-target="togglableElement">
      <% if policy(@activity).owner? %>
        <div class="d-flex">
          <%= link_to '<i class="fa-solid fa-pen"></i>'.html_safe, edit_activity_path(@activity), class: "btn-icon me-3" %>
          <%= link_to '<i class="fa-regular fa-trash-can"></i>'.html_safe, @activity, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this activity?" }, class: "btn-icon" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-1 booking-btns d-flex flex-row-reverse">
    <% if (@user_booking && current_user != @activity.user) %>
      <%= link_to "See my booking", bookings_path, class: "btn btn-info" %>
    <% elsif current_user != @activity.user %>
      <%= button_to "Book Now", book_activity_path(@activity), method: :post, class: "btn btn-secondary d-block rounded-button" %>
    <% end %>
  </div>
</div>

<div class="activity-photo-container my-3">
  <% if @activity.photo.attached? %>
    <%= image_tag @activity.photo, class: "activity-card-image" %>
  <% else %>
    <p class="text-center text-muted">No photo available</p>
  <% end %>
  <h1 class="activity-title-overlay"><%= @activity.title %></h1>
</div>

<div class="container px-4 pb-4 mb-5">
  <p><%= @activity.description %></p>
  <hr>
  <ul class="list-unstyled activity-information mb-4">
    <li class="d-flex align-items-center">
      <i class="fa-solid fa-fire-flame-curved show-icon", style="margin-right: 12px; margin-left: 3px;"></i>
      <span> <%= @activity.category.capitalize %></span>
    </li>

    <li class="d-flex align-items-center">
      <i class="fas fa-trophy show-icon"></i>
      <span><%= @activity.level %></span>
    </li>

    <li class="d-flex align-items-center">
      <i class="fas fa-clock show-icon", style="margin-left: 1px;"></i>
      <span><%= @activity.start.strftime("%A, %d %b %Y %l:%M %p") %> <%= format_duration(@activity.duration) %></span>
    </li>

    <li class="d-flex align-items-center">
      <i class="fas fa-map-marker-alt show-icon", style="margin-right: 12px; margin-left: 2px;"></i>
      <span><%= @activity.location %></span>
    </li>

    <li class="d-flex align-items-center">
      <i class="fa-solid fa-circle-dollar-to-slot show-icon"></i>
      <span><%= format_price(@activity.price) %></span>
    </li>
  </ul>

  <div class="info-box">
    <h5 class="info-title">Important Information</h5>
    <p class="info-text">This is a placeholder text that can be replaced with your important information. Make sure to keep it concise and clear.</p>
  </div>

  <% unless current_user.bookings.exists?(activity: @activity) %>
    <div class="d-flex justify-content-center mt-4">
      <%= button_to "Book Now", book_activity_path(@activity), method: :post, class: "btn btn-secondary d-block rounded-button" %>
    </div>
  <% end %>

  <div class=mt-4>
    <h3>Find us!</h3>
    <div id="map" style="height: 400px; width: 100%;"></div>
  </div>

  <p class="card-text text-end"><strong>Organized by:</strong> <%= @activity.user.first_name.capitalize %></p>
</div>



<script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">

<script>

<!-- In your HTML (e.g., application.html.erb or your view) -->
<div id="map" style="width: 100%; height: 400px;"></div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.9.0/mapbox-gl.css" rel="stylesheet" />

<script>

  mapboxgl.accessToken = 'pk.eyJ1IjoibnJvbWFzYW50YSIsImEiOiJjbTE5MjYzNjcxMDdjMmptenN2M2F3ZzZnIn0.2iI2J6g6qNHHZ4gKxZFaqw';

  var latitude = <%= @activity.latitude %>;
  var longitude = <%= @activity.longitude %>;

  console.log(latitude, longitude);

  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [longitude, latitude],
    zoom: 12
  });

  new mapboxgl.Marker()
    .setLngLat([longitude, latitude])
    .setPopup(new mapboxgl.Popup({ offset: 25 }).setHTML("<b><%= @activity.title %></b><br><%= @activity.location %>"))
    .addTo(map);
</script>
